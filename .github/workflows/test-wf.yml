name: Test

on:
  workflow_dispatch:

# Use concurrency to enforce only 1 workflow can run at a time
concurrency:
  group: test-deploy-${{ ((github.run_number == 0 || endsWith(github.run_number, '00') || github.run_number == 3 || endsWith(github.run_number, '03') || github.run_number == 6 || endsWith(github.run_number, '06') || github.run_number == 9 || endsWith(github.run_number, '09') || endsWith(github.run_number, '12') || endsWith(github.run_number, '15') || endsWith(github.run_number, '18') || endsWith(github.run_number, '21') || endsWith(github.run_number, '24') || endsWith(github.run_number, '27') || endsWith(github.run_number, '30') || endsWith(github.run_number, '33') || endsWith(github.run_number, '36') || endsWith(github.run_number, '39') || endsWith(github.run_number, '42') || endsWith(github.run_number, '45') || endsWith(github.run_number, '48') || endsWith(github.run_number, '51') || endsWith(github.run_number, '54') || endsWith(github.run_number, '57') || endsWith(github.run_number, '60') || endsWith(github.run_number, '63') || endsWith(github.run_number, '66') || endsWith(github.run_number, '69') || endsWith(github.run_number, '72') || endsWith(github.run_number, '75') || endsWith(github.run_number, '78') || endsWith(github.run_number, '81') || endsWith(github.run_number, '84') || endsWith(github.run_number, '87') || endsWith(github.run_number, '90') || endsWith(github.run_number, '93') || endsWith(github.run_number, '96') || endsWith(github.run_number, '99'))) && '0' || (((github.run_number == 1 || endsWith(github.run_number, '01') || github.run_number == 4 || endsWith(github.run_number, '04') || github.run_number == 7 || endsWith(github.run_number, '07') || endsWith(github.run_number, '10') || endsWith(github.run_number, '13') || endsWith(github.run_number, '16') || endsWith(github.run_number, '19') || endsWith(github.run_number, '22') || endsWith(github.run_number, '25') || endsWith(github.run_number, '28') || endsWith(github.run_number, '31') || endsWith(github.run_number, '34') || endsWith(github.run_number, '37') || endsWith(github.run_number, '40') || endsWith(github.run_number, '43') || endsWith(github.run_number, '46') || endsWith(github.run_number, '49') || endsWith(github.run_number, '52') || endsWith(github.run_number, '55') || endsWith(github.run_number, '58') || endsWith(github.run_number, '61') || endsWith(github.run_number, '64') || endsWith(github.run_number, '67') || endsWith(github.run_number, '70') || endsWith(github.run_number, '73') || endsWith(github.run_number, '76') || endsWith(github.run_number, '79') || endsWith(github.run_number, '82') || endsWith(github.run_number, '85') || endsWith(github.run_number, '88') || endsWith(github.run_number, '91') || endsWith(github.run_number, '94') || endsWith(github.run_number, '97'))) && '1' || '2') }}

env:
  # Name of Azure Web APP
  APP_NAME: app
  NUM: ${{ github.run_number }}
  ISEVEN: ${{ endsWith(github.run_number, fromJSON('["0", "2", "4", "6", "8"]')) }}
  TESTDATA: ${{ (endsWith(github.run_number, '0') || endsWith(github.run_number, '3') || endsWith(github.run_number, '6')) && '1' || ((endsWith(github.run_number, '1') || endsWith(github.run_number, '4') || endsWith(github.run_number, '7')) && '2' || '3' ) }}
  TESTEXPR: ${{ ((github.run_number == 0 || endsWith(github.run_number, '00') || github.run_number == 3 || endsWith(github.run_number, '03') || github.run_number == 6 || endsWith(github.run_number, '06') || github.run_number == 9 || endsWith(github.run_number, '09') || endsWith(github.run_number, '12') || endsWith(github.run_number, '15') || endsWith(github.run_number, '18') || endsWith(github.run_number, '21') || endsWith(github.run_number, '24') || endsWith(github.run_number, '27') || endsWith(github.run_number, '30') || endsWith(github.run_number, '33') || endsWith(github.run_number, '36') || endsWith(github.run_number, '39') || endsWith(github.run_number, '42') || endsWith(github.run_number, '45') || endsWith(github.run_number, '48') || endsWith(github.run_number, '51') || endsWith(github.run_number, '54') || endsWith(github.run_number, '57') || endsWith(github.run_number, '60') || endsWith(github.run_number, '63') || endsWith(github.run_number, '66') || endsWith(github.run_number, '69') || endsWith(github.run_number, '72') || endsWith(github.run_number, '75') || endsWith(github.run_number, '78') || endsWith(github.run_number, '81') || endsWith(github.run_number, '84') || endsWith(github.run_number, '87') || endsWith(github.run_number, '90') || endsWith(github.run_number, '93') || endsWith(github.run_number, '96') || endsWith(github.run_number, '99'))) && '0' || (((github.run_number == 1 || endsWith(github.run_number, '01') || github.run_number == 4 || endsWith(github.run_number, '04') || github.run_number == 7 || endsWith(github.run_number, '07') || endsWith(github.run_number, '10') || endsWith(github.run_number, '13') || endsWith(github.run_number, '16') || endsWith(github.run_number, '19') || endsWith(github.run_number, '22') || endsWith(github.run_number, '25') || endsWith(github.run_number, '28') || endsWith(github.run_number, '31') || endsWith(github.run_number, '34') || endsWith(github.run_number, '37') || endsWith(github.run_number, '40') || endsWith(github.run_number, '43') || endsWith(github.run_number, '46') || endsWith(github.run_number, '49') || endsWith(github.run_number, '52') || endsWith(github.run_number, '55') || endsWith(github.run_number, '58') || endsWith(github.run_number, '61') || endsWith(github.run_number, '64') || endsWith(github.run_number, '67') || endsWith(github.run_number, '70') || endsWith(github.run_number, '73') || endsWith(github.run_number, '76') || endsWith(github.run_number, '79') || endsWith(github.run_number, '82') || endsWith(github.run_number, '85') || endsWith(github.run_number, '88') || endsWith(github.run_number, '91') || endsWith(github.run_number, '94') || endsWith(github.run_number, '97'))) && '1' || '2') }}
  

jobs:
  build:
    if: |
      github.event_name == 'push' ||
      (github.event_name == 'pull_request' && github.head_ref == 'master')
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4

      - name: run number with offset
        run: |
          echo "GITHUB_RUN_NUMBER_WITH_OFFSET=$(($NUM + 200))" >> $GITHUB_ENV
          echo "run_number: ${{ github.run_number }}"
          echo "run_id: ${{ github.run_id }}"
          echo "run_number[0]: ${{ format('{0}', github.run_number)[0] }}"
          echo "run_number[1]: ${{ format('{0}', github.run_number)[1] }}"
          echo "run_number[-1]: ${{ format('{0}', github.run_number)[-1] }}"
          echo "ISEVEN: ${{ env.ISEVEN }}"
          echo "TESTDATA: ${{ env.TESTDATA }}"
          echo "TESTEXPR: ${{ env.TESTEXPR }}"

      - name: dotnet Publish App
        run: sleep ${{ vars.VAR_SLEEPDURATION }} && echo ${{ vars.VAR_TESTMESSAGE }}
